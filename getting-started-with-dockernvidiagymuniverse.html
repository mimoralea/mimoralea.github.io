<!DOCTYPE html>
<html lang="en">

  <head>
    <link rel="stylesheet" type="text/css" href="./theme/css/style.css">
    <link href="./theme/css/pygments.css" rel="stylesheet">
    <!--link rel="stylesheet" type="text/css" href="./theme/css/prism.css"-->
    <!--script src="./theme/js/prism.js"></script-->
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Miguel Morales">
    <meta name="description" content="Posts and writings by Miguel Morales">

    <link href="http://www.mimoralea.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="mimoralea.com Atom" />

<meta name="keywords" content="">

    <title>
      mimoralea.com
&ndash; Getting Started With Docker+<span class="caps">NVIDIA</span>+Gym+Universe    </title>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-65422309-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
  </head>

  <body>
    <aside>
      <div id="user_meta">
	<a href=".">
	</a>
	<h2><a href=".">mimoralea.com</a></h2>
	<h4></h4>
	<p></p>
        <a href="./pages/about.html">About</a>
	<br/>
        <a href="/pdfs/resume.pdf" target="_blank">Resume</a>
	<br/>
        <a href="https://www.linkedin.com/pub/miguel-morales/65/28/136/" target="_blank">LinkedIn</a>
	<br/>
        <a href="https://www.github.com/mimoralea" target="_blank">Github</a>
	<br/>
        <a href="https://www.twitter.com/mimoralea" target="_blank">Twitter</a>
	<br/>
        <a href="https://www.quora.com/profile/Miguel-Morales-32" target="_blank">Quora</a>
	<br/>
        <a href="https://stackoverflow.com/users/786279/mimoralea" target="_blank">Stackoverflow</a>
	<br/>
        <a href="https://plus.google.com/+MiguelMorales-mimoralea" target="_blank">Google+</a>
	<br/>
	<br/>
      </div>
    </aside>

    <main>
      <header>
	<p>
	  <a href=".">Index</a> &brvbar;
	  <a href="./archives.html">Archives</a> &brvbar;
	  <a href="./categories.html">Categories</a>
	</p>
      </header>
      <div id="main_body">
<article>
  <div class="article_title">
    <h3><a href="./getting-started-with-dockernvidiagymuniverse.html">Getting Started With Docker+<span class="caps">NVIDIA</span>+Gym+Universe</a></h3>
  </div>
  <div class="article_text">
    <h2>Intro</h2>
<p>This post walks you through how to get started with OpenAI Universe. Along the way,
you will need to install additional software to make your Universe installation usable.
We will install Docker and configure it to work with your user, then we will install
docker <span class="caps">NVIDIA</span> to be able to use your <span class="caps">GPU</span> when solving Universe environements, then we
will install OpenAI Gym and&nbsp;Universe.</p>
<p>At the end our stack will look something like&nbsp;this:</p>
<pre>
                  Agent Container
                   ^
(Host w/ GPUs) -> (Docker Engine)
                   v
                  Universe Container
</pre>

<h2>Setup&nbsp;Docker</h2>
<p>Depending on your environment Docker would be easy to install. Most of the times,
however, I read tutorials out there that failed in one thing. While the Docker daemon
always run as the root user, the client better be run as separate user. This security
measure is simple, but it can get messy if you are not aware of the fact. You should
create a docker user and group and then add your user to the docker group so you don&#8217;t
have to prefix your docker commands with <code>sudo</code>.</p>
<p>Let&#8217;s get Docker&nbsp;working</p>
<h3>Installing&nbsp;binaries</h3>
<h4>Fedora</h4>
<div class="highlight"><pre><span></span>sudo dnf -y install docker-io
</pre></div>


<h4>Arch</h4>
<div class="highlight"><pre><span></span>yaourt -S docker
</pre></div>


<h3>Add docker&nbsp;group</h3>
<p><strong><span class="caps">NOTE</span>: This step is not required by some systems that add the docker group during
the binaries install, however, it doesn&#8217;t hurt to run. It would just fail if the
group is already&nbsp;installed.</strong></p>
<div class="highlight"><pre><span></span>sudo groupadd docker
</pre></div>


<h3>Add your user to the Docker&nbsp;group</h3>
<div class="highlight"><pre><span></span>sudo usermod -aG docker <span class="nv">$USER</span>
</pre></div>


<h3>Start the Docker&nbsp;daemon</h3>
<div class="highlight"><pre><span></span>sudo systemctl <span class="nb">enable</span> docker
sudo systemctl start docker
</pre></div>


<h3>Go for a&nbsp;reboot</h3>
<p>It&#8217;s important to get all the permissions straight. There are some
<a href="http://www.mimoralea.com/installing-docker-on-fedora-23.html">workarounds</a>
that you might want to try if you really don&#8217;t want to go for a reboot,
but I&#8217;ve experienced some inconsistencies with this method so, I
still recommend the&nbsp;reboot.</p>
<div class="highlight"><pre><span></span>sudo reboot
</pre></div>


<h3>Test Docker is&nbsp;working</h3>
<div class="highlight"><pre><span></span>docker run hello-world
</pre></div>


<p>This command will the &#8220;hello world&#8221; container, which is basically a container
that is downloaded from a repository and it prints a message to the console.
Nothing fancy, but if that works for you we can move to the next&nbsp;step.</p>
<h2>Setup <span class="caps">NVIDIA</span>&nbsp;Docker</h2>
<p><a href="https://github.com/NVIDIA/nvidia-docker"><span class="caps">NVIDIA</span> Docker</a> is a toolkit
that allows you to easily build Docker containers that have access to the
host GPUs. It&#8217;s fairly simple to&nbsp;install:</p>
<h3>Installing&nbsp;binaries</h3>
<h3>Fedora</h3>
<div class="highlight"><pre><span></span>wget -P /tmp https://github.com/NVIDIA/nvidia-docker/releases/download/v1.0.0-rc.3/nvidia-docker-1.0.0.rc.3-1.x86_64.rpm
sudo rpm -i /tmp/nvidia-docker*.rpm <span class="o">&amp;&amp;</span> rm /tmp/nvidia-docker*.rpm
</pre></div>


<h3>Arch</h3>
<div class="highlight"><pre><span></span>yaourt -S nvidia-docker
sudo -b nohup nvidia-docker-plugin &gt; /tmp/nvidia-docker.log
</pre></div>


<h3>Start the <span class="caps">NVIDIA</span> Docker&nbsp;daemon</h3>
<div class="highlight"><pre><span></span>sudo systemctl <span class="nb">enable</span> nvidia-docker
sudo systemctl start nvidia-docker
</pre></div>


<h3>Test <span class="caps">NVIDIA</span> Docker is&nbsp;working</h3>
<div class="highlight"><pre><span></span>nvidia-docker run --rm nvidia/cuda nvidia-smi
</pre></div>


<p>This command will create a Docker container with <span class="caps">CUDA</span> toolkit loaded, it will
simply run the nvidia-smi command which prints the detected GPUs and their load.
If you are able to see the nvidia-smi output, feel free to move&nbsp;forward!</p>
<h2>Setup a&nbsp;containers</h2>
<p>Now that we are able to build containers with access to the GPUs, let create a
couple of&nbsp;containers.</p>
<p>The first container will be the Agent&#8217;s. This container will
need to be able to communicate with the environment container and process the
inputs from the Universe environment, process them and return a set of actions. In this
container we are going to want libraries that leverage GPUs like TensorFlow, Theano
and Keras. Let&#8217;s get it&nbsp;going!</p>
<h3>Create the agent&nbsp;container</h3>
<div class="highlight"><pre><span></span>nvidia-docker run -it --name agent -h agent nvidia/cuda /bin/bash
</pre></div>


<h3>Create the environment&#8217;s&nbsp;container</h3>
<div class="highlight"><pre><span></span>nvidia-docker run -it --name environment -h environment <span class="se">\</span>
    --link agent:agent nvidia/cuda /bin/bash
</pre></div>


<p>With these commands now you can ping the agent container from the environment container,
but not the other way around. To fix this, let&#8217;s just add a record to the <code>/etc/hosts</code>
of the agent&#8217;s container. First, look up the ip address of <code>environment</code> E.g. <code>cat /etc/hosts</code>.
Then copy the last line and add it to the <code>/etc/hosts</code> of the agent&#8217;s&nbsp;container.</p>
<h3>Verify <span class="caps">NDIVIA</span> toolkit is in both&nbsp;containers</h3>
<div class="highlight"><pre><span></span>nvidia-smi
</pre></div>


<h3>Verify you can ping both <code>agent</code> and <code>environment</code> from each&nbsp;container</h3>
<div class="highlight"><pre><span></span>ping -c <span class="m">3</span> agent
ping -c <span class="m">3</span> environment
</pre></div>


<h3>Install required&nbsp;packages</h3>
<h4>Agent&nbsp;packages</h4>
<div class="highlight"><pre><span></span>apt-get update -y
apt-get install -y golang libjpeg-turbo8-dev make <span class="se">\</span>
        chromium-browser git cmake zlib1g-dev libjpeg-dev xvfb <span class="se">\</span>
    libav-tools xorg-dev python-opengl libboost-all-dev libsdl2-dev swig
</pre></div>


<h4>Environments&nbsp;packages</h4>
<div class="highlight"><pre><span></span>apt-get update -y
apt-get install -y python3 python3-pip python python-pip <span class="se">\</span>
        git python3-dev python-dev
</pre></div>


<h3>Install OpenAI&nbsp;packages</h3>
<div class="highlight"><pre><span></span>git clone https://github.com/openai/gym.git
git clone https://github.com/openai/universe.git
<span class="nb">cd</span> gym <span class="o">&amp;&amp;</span> pip install -e <span class="s1">&#39;.[all]&#39;</span>
<span class="nb">cd</span> ../universe <span class="o">&amp;&amp;</span> pip install -e .
</pre></div>


<h2>Setup a container for the&nbsp;environment</h2>
<h2>Test OpenAI&nbsp;Gym</h2>
<h2>Test OpenAI&nbsp;Universe</h2>
<h2>Test <span class="caps">GPU</span>&#8217;s&nbsp;functionality</h2>
  </div>
  <div class="article_meta">
    <p>Posted on: Mon 19 December 2016</p>
    <p>Category: <a href="./category/reinforcement-learning.html">reinforcement-learning</a>
    </p>
  </div>
  <div id="article_comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_identifier = "getting-started-with-dockernvidiagymuniverse.html";
      (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://mimoralea.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
  </div>

</article>


      </div>

      <div id="ending_message">
      <p>By Miguel Morales.</p>
      </div>
    </main>
  </body>
</html>